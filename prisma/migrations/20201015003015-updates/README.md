# Migration `20201015003015-updates`

This migration has been generated by Cipriano at 10/14/2020, 9:30:15 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
Begin;
CREATE TYPE "public"."Role_new" AS ENUM ('CANDIDATE', 'EMPLOYER', 'ADMIN');
ALTER TABLE "public"."User" ALTER COLUMN "role" TYPE "Role_new" USING ("role"::text::"Role_new");
ALTER TABLE "public"."Company" ALTER COLUMN "role" TYPE "Role_new" USING ("role"::text::"Role_new");
ALTER TABLE "public"."Agency" ALTER COLUMN "role" TYPE "Role_new" USING ("role"::text::"Role_new");
ALTER TYPE "Role" RENAME TO "Role_old";
ALTER TYPE "Role_new" RENAME TO "Role";
DROP TYPE "Role_old";
Commit

ALTER TABLE "public"."User" DROP COLUMN "key",
ADD COLUMN "authenticationkey" text   NOT NULL ,
ADD COLUMN "securitykey" text   NOT NULL ,
ADD COLUMN "ativo" boolean   NOT NULL DEFAULT true

CREATE TABLE "public"."Address" (
"id" text   NOT NULL ,
"name" text   NOT NULL ,
"logradouro" text   NOT NULL ,
"bairro" text   NOT NULL ,
"cidade" text   NOT NULL ,
"uf" text   NOT NULL ,
"cep" text   NOT NULL ,
"createdat" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedat" timestamp(3)   NOT NULL ,
"userid" integer   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Contact" (
"id" text   NOT NULL ,
"userid" integer   NOT NULL ,
"createdat" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedat" timestamp(3)   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Curriculum" (
"id" text   NOT NULL ,
"userid" integer   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Company" (
"id" text   NOT NULL ,
"name" text   NOT NULL ,
"registrofederal" text   NOT NULL ,
"ativo" boolean   NOT NULL DEFAULT false,
"role" "Role"  NOT NULL DEFAULT E'EMPLOYER',
"createdat" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedat" timestamp(3)   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Agency" (
"id" text   NOT NULL ,
"name" text   NOT NULL ,
"registrofederal" text   NOT NULL ,
"ativo" boolean   NOT NULL DEFAULT false,
"role" "Role"  NOT NULL DEFAULT E'EMPLOYER',
"createdat" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedat" timestamp(3)   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE UNIQUE INDEX "Curriculum_userid_unique" ON "public"."Curriculum"("userid")

ALTER TABLE "public"."Address" ADD FOREIGN KEY ("userid")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Contact" ADD FOREIGN KEY ("userid")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Curriculum" ADD FOREIGN KEY ("userid")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201011185711-up..20201015003015-updates
--- datamodel.dml
+++ datamodel.dml
@@ -1,45 +1,104 @@
-// This is your Prisma schema file,
-// learn more about it in the docs: https://pris.ly/d/prisma-schema
-
-datasource db {
-  provider = "postgresql"
-  url = "***"
-}
-
-generator client {
-  provider = "prisma-client-js"
-}
-
-model Profile {
-  id        String   @default(uuid()) @id
-  bio       String?
-  pseudonym String?
-  User      User     @relation(fields: [userId], references: [id])
-  userId    Int      @unique
-  createdat DateTime @default(now())
-  updatedat DateTime @updatedAt
-}
-
-model User {
-  id               Int      @default(autoincrement()) @id
-  key              String   @default(uuid())
-  
-  secret           String?
-  fullname         String
-  email            String   @unique
-  cpf              String   @unique
-  role             Role     @default(CANDIDATE)
-  datebirth        String?
-  nickname         String?  @unique
-  preferencialname String?
-  Profile          Profile?
-  createdat        DateTime @default(now())
-  updatedat        DateTime @updatedAt
-}
-
-enum Role {
-  USER
-  CANDIDATE
-  EMPLOYER
-  ADMIN
-}
+// https://www.meucurriculoperfeito.com.br/criar-curriculo/section/cntc
+// & https://www.prisma.io/docs/reference/tools-and-interfaces/prisma-schema/relations
+datasource db {
+    provider = "postgresql"
+    url = "***"
+}
+
+generator client {
+    provider = "prisma-client-js"
+}
+
+model Profile {
+    id        String  @id @default(uuid())
+    bio       String?
+    pseudonym String?
+    User      User    @relation(fields: [userId], references: [id])
+    userId    Int     @unique
+
+    createdat DateTime @default(now())
+    updatedat DateTime @updatedAt
+}
+
+model User {
+    id                Int    @id @default(autoincrement())
+    authenticationkey String @default(uuid())
+    securitykey       String @default(uuid())
+
+    fullname         String
+    secret           String?
+    ativo            Boolean @default(true)
+    email            String  @unique
+    cpf              String  @unique
+    role             Role    @default(CANDIDATE)
+    datebirth        String?
+    nickname         String? @unique
+    preferencialname String?
+
+    Profile    Profile?
+    Address    Address[]
+    Contact    Contact[]
+    Curriculum Curriculum?
+
+    createdat DateTime @default(now())
+    updatedat DateTime @updatedAt
+}
+
+model Address {
+    id         String @id @default(uuid())
+    name       String
+    logradouro String
+    bairro     String
+    cidade     String
+    uf         String
+    cep        String
+
+    createdat DateTime @default(now())
+    updatedat DateTime @updatedAt
+    User      User     @relation(fields: [userid], references: [id])
+    userid    Int
+}
+
+model Contact {
+    id     String @id @default(uuid())
+    User   User   @relation(fields: [userid], references: [id])
+    userid Int
+
+    createdat DateTime @default(now())
+    updatedat DateTime @updatedAt
+
+}
+
+model Curriculum {
+    id     String @id @default(uuid())
+    User   User   @relation(fields: [userid], references: [id])
+    userid Int
+}
+
+enum Role {
+    CANDIDATE
+    EMPLOYER
+    ADMIN
+}
+
+model Company {
+    id              String  @id @default(uuid())
+    name            String
+    registrofederal String
+    ativo           Boolean @default(false)
+    role            Role    @default(EMPLOYER)
+
+    createdat DateTime @default(now())
+    updatedat DateTime @updatedAt
+}
+
+model Agency {
+    id              String  @id @default(uuid())
+    name            String
+    registrofederal String
+    ativo           Boolean @default(false)
+    role            Role    @default(EMPLOYER)
+
+    createdat DateTime @default(now())
+    updatedat DateTime @updatedAt
+}
```


